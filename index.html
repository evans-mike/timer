<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Time Timer (Tap Circle, Traffic Light Colors, Icons)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Favicon (stopwatch icon). 
  Could be .png, .ico, or .svg; just adjust the type accordingly. -->
  <link rel="icon" href="timer.png" type="image/png" />

  <!-- Apple touch icon placeholder. 
      iOS devices will use this when the user adds the site to their home screen. -->
  <link rel="apple-touch-icon" href="timer.png" />

  <!-- Example: iOS Wheel Picker CSS (if you're using a library) -->
  <!-- <link rel="stylesheet" href="https://unpkg.com/ios-wheel-picker/dist/iosWheelPicker.min.css" /> -->
     
  <style>
    /* RESET & BOX-SIZING */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0; 
      padding: 0;
    }

    /* BODY & HTML */
    html, body {
      width: 100%;
      height: 100%;
    }
    body {
      /* iOS-like system fonts */
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
                   Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      background-color: #F9F9F9;
      color: #222;
      overflow-x: hidden; /* hide horizontal scroll if any */
    }

    /* A "dark-mode" class toggles a darker theme */
    body.dark-mode {
      background-color: #111;
      color: #eee;
    }

    /* GRID CONTAINER */
    .container {
      /* If you want the circle area to fill the remaining space,
        you can keep grid-template-rows: auto auto 1fr, etc. */
      display: grid;
      grid-template-rows: auto auto 1fr;
      gap: 1rem;
      min-height: 100vh;
      max-width: 500px;
      margin: 0 auto;
      padding: 1rem;
    }

    /* The circle area row, centered content */
    .circle-area {
      /* Make the row itself a flex container that centers items */
      display: flex;
      align-items: center;    /* vertical centering within the row */
      justify-content: center;/* horizontal centering within the row */
      position: relative;     /* so we can absolutely position the icon */
      cursor: pointer;        /* keep the circle clickable */
    }

    /* The <svg> that shows the circle. Margin auto for extra safety. */
    .circle-area svg {
      display: block;
      width: 95vw;       /* up to 95% of viewport width on mobile */
      max-width: 450px;  /* but never exceed 450px on desktop */
      height: auto;
      margin: 0 auto;    /* center horizontally if needed */
    }

    /* The icon in the center of the circle */
    .circle-icon {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none; /* so taps/clicks go "through" to the circle */
      font-size: 3rem;
      color: #000; /* or whichever color you prefer */
    }


    /* TOP BAR: refresh icon, title, dark-mode toggle */
    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    /* REFRESH BUTTON */
    .icon-button {
      background: none;
      border: none;
      font-size: 1.4rem;
      cursor: pointer;
      color: #007AFF; /* iOS-like blue */
      padding: 0.25rem 0.5rem;
      transition: color 0.2s;
    }
    .icon-button:hover {
      color: #006AE6;
    }

    /* TITLE in the middle */
    .title {
      font-size: 1.4rem;
      font-weight: 600;
      text-align: center;
      flex: 1; /* so it takes the remaining space between refresh & toggle */
    }

    /* TOGGLE SWITCH (iOS style) */
    .toggle-switch {
      position: relative;
      width: 50px;
      height: 28px;
    }
    .toggle-switch input {
      display: none; /* hide the actual checkbox */
    }
    .toggle-switch label {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #ccc;
      border-radius: 999px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .toggle-switch label::after {
      content: "";
      position: absolute;
      top: 2px;
      left: 2px;
      width: 24px;
      height: 24px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.2s;
    }
    .toggle-switch input:checked + label {
      background: #007AFF; /* iOS blue */
    }
    .toggle-switch input:checked + label::after {
      transform: translateX(22px);
    }

    /* CONTROLS: just time input now (no Start button) */
    .controls {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .time-input {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }
    .time-input select {
      width: 60px;
      font-size: 0.9rem;
      padding: 0.3rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      background-color: #fff;
      appearance: none;
      text-align: center;
    }
    .time-input span {
      font-size: 1.2rem;
      color: #444;
    }

    /* CIRCLE AREA */
    .circle-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      cursor: pointer; /* show pointer on hover, since it's tappable */
      position: relative; /* so we can position icons absolutely */
    }

    /* Make the circle fill nearly the full width on mobile,
       but never exceed 450px on desktop. */
    .circle-area svg {
      display: block;
      width: 95vw;       /* ~95% of the viewport width on mobile */
      max-width: 450px;  /* do not exceed 450px in diameter on desktop */
      height: auto;
      margin: 0 auto;
    }

    /* The icon in the center of the circle */
    .circle-icon {
      position: absolute;
      font-size: 3rem;
      pointer-events: none; /* ignore clicks on the icon itself */
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #000; /* black icon stands out against bright circle colors */
    }

    /* TIMER TEXT BELOW THE CIRCLE */
    .timer-text {
      margin-top: 1rem;
      font-size: 2rem;
      color: inherit; /* so it adjusts in dark mode */
      text-align: center;
    }

    /* DARK MODE TWEAKS */
    body.dark-mode .icon-button {
      color: #aaa; 
    }
    body.dark-mode .time-input select {
      background-color: #333;
      color: #eee;
      border-color: #555;
    }
    body.dark-mode .toggle-switch label {
      background: #555;
    }
  </style>
</head>
<body>

<div class="container">
  <!-- TOP BAR (row 1) -->
  <div class="top-bar">
    <!-- Left: refresh icon button -->
    <button id="refreshButton" class="icon-button" aria-label="Refresh">
      &#x21BB;
    </button>
    <!-- Middle: Title -->
    <div class="title">Time Timer</div>
    <!-- Right: iOS-style toggle for dark mode -->
    <div class="toggle-switch">
      <input type="checkbox" id="darkModeToggle" />
      <label for="darkModeToggle"></label>
    </div>
  </div>

  <!-- CONTROLS (row 2) -->
  <div class="controls">
    <!-- Time input: two selects with a colon in between -->
    <div class="time-input">
      <select id="minutesSelect"></select>
      <span>:</span>
      <select id="secondsSelect"></select>
    </div>
  </div>

  <!-- CIRCLE AREA (row 3) - tap to Start/Pause/Resume -->
  <div class="circle-area" id="circleArea">
    <svg id="circleSvg" viewBox="0 0 200 200">
      <!-- Mirroring group -->
      <g transform="scale(-1,1) translate(-200,0)">
        <!-- Background circle (we won't change its fill) -->
        <circle
          id="circleBackground"
          cx="100"
          cy="100"
          r="90"
          fill="#EAEAEA"
        />
        <!-- Arc that shrinks over time; color changes per state -->
        <path
          id="circleForeground"
          fill="#FF3B30"  <!-- default red for idle -->
          d=""
        />
      </g>
    </svg>
    <!-- Icon in the center of the circle -->
    <div class="circle-icon" id="circleIcon">&#x23F9;</div>
    <!-- Countdown text below the circle -->
    <div class="timer-text" id="timerText">--:--</div>
  </div>
</div>

<script>
  // Timer states: "idle", "running", "paused", "finished"
  let timerState = "idle";

  // We'll store the last used time and dark mode preference in localStorage
  const STORAGE_TIME_KEY  = 'timerValue';  // "MM:SS"
  const STORAGE_THEME_KEY = 'darkMode';    // "true" or "false"

  // Elements
  const refreshButton    = document.getElementById('refreshButton');
  const darkModeToggle   = document.getElementById('darkModeToggle');
  const minutesSelect    = document.getElementById('minutesSelect');
  const secondsSelect    = document.getElementById('secondsSelect');
  const circleArea       = document.getElementById('circleArea');
  const timerText        = document.getElementById('timerText');
  const circleForeground = document.getElementById('circleForeground');
  const circleIcon       = document.getElementById('circleIcon');

  let countdownInterval;
  let totalTime     = 0; // total seconds
  let timeRemaining = 0; // seconds left

  const stateColors = {
    idle:     "#007AFF",  // iOS Blue
    running:  "#34C759",  // iOS Green
    paused:   "#FFCC00",  // iOS Yellow
    finished: "#FF3B30"   // iOS Red
  };

  const stateIcons = {
    idle:     "&#x25B6;", // play
    running:  "&#x23F8;", // pause
    paused:   "&#x25B6;", // play
    finished: ""          // no icon
  };


  // Populate dropdowns for 0..59
  for (let i = 0; i < 60; i++) {
    const optMin = document.createElement('option');
    optMin.value = i;
    optMin.text  = i.toString();
    minutesSelect.appendChild(optMin);

    const optSec = document.createElement('option');
    optSec.value = i;
    optSec.text  = i.toString();
    secondsSelect.appendChild(optSec);
  }

  // On page load, set up from localStorage or default
  function init() {
    // 1) Restore dark mode preference
    const storedDarkMode = localStorage.getItem(STORAGE_THEME_KEY);
    if (storedDarkMode === 'true') {
      document.body.classList.add('dark-mode');
      darkModeToggle.checked = true;
    }

    // 2) Restore time
    const storedTime = localStorage.getItem(STORAGE_TIME_KEY);
    if (storedTime) {
      const [mm, ss] = storedTime.split(':').map(Number);
      minutesSelect.value = mm;
      secondsSelect.value = ss;
    } else {
      // Otherwise, default to 20:00
      minutesSelect.value = 20;
      secondsSelect.value = 0;
    }

    // Set up arc/time display for idle
    updateTimerFromDropdown();
    setTimerState("idle");
    updateTimerTextAndArc(timeRemaining);
  }

  // Change the timer state => update arc color, icon, etc.
  function setTimerState(newState) {
    timerState = newState;
    circleForeground.setAttribute("fill", stateColors[newState]);
    circleIcon.innerHTML = stateIcons[newState];
  }

  // Read dropdown => totalTime, save to localStorage, update arc
  function updateTimerFromDropdown() {
    const mm = parseInt(minutesSelect.value, 10);
    const ss = parseInt(secondsSelect.value, 10);
    totalTime = mm * 60 + ss;
    localStorage.setItem(STORAGE_TIME_KEY, `${mm}:${ss}`); // store "MM:SS"

    // If idle or finished, reset arc/time display
    if (timerState === "idle" || timerState === "finished") {
      timeRemaining = totalTime;
    }
  }

  // Circle tap => Start/Pause/Resume logic
  function onCircleTap() {
    if (timerState === "idle" || timerState === "finished") {
      // Start from the beginning
      startTimer();
      setTimerState("running");
    } else if (timerState === "running") {
      // Pause
      pauseTimer();
      setTimerState("paused");
    } else if (timerState === "paused") {
      // Resume
      resumeTimer();
      setTimerState("running");
    }
  }

  // Start from full time
  function startTimer() {
    clearInterval(countdownInterval);
    updateTimerFromDropdown(); // ensure totalTime is correct
    timeRemaining = totalTime;
    runInterval();
  }

  // Pause
  function pauseTimer() {
    clearInterval(countdownInterval);
  }

  // Resume
  function resumeTimer() {
    runInterval();
  }

  // Actually run the countdown (interval)
  function runInterval() {
    updateTimerTextAndArc(timeRemaining);
    countdownInterval = setInterval(() => {
      timeRemaining -= 0.1;
      if (timeRemaining <= 0) {
        timeRemaining = 0;
        clearInterval(countdownInterval);
        // Timer done => turn circle red (finished)
        setTimerState("finished");
        updateTimerTextAndArc(timeRemaining);
        return;
      }
      updateTimerTextAndArc(timeRemaining);
    }, 100);
  }

  // Update arc path and text
  function updateTimerTextAndArc(remaining) {
    let fractionLeft = (totalTime > 0) ? remaining / totalTime : 0;
    if (fractionLeft < 0) fractionLeft = 0;
    if (fractionLeft > 1) fractionLeft = 1;

    const angle = fractionLeft * 360;
    circleForeground.setAttribute('d', describeArc(100, 100, 90, angle));
    timerText.textContent = formatTime(remaining);
  }

  // Convert seconds => "MM:SS"
  function formatTime(seconds) {
    if (seconds < 0) seconds = 0;
    const mm = Math.floor(seconds / 60);
    const ss = Math.floor(seconds % 60);
    return mm + ":" + ss.toString().padStart(2, "0");
  }

  // Build a wedge (pie slice) arc in SVG
  function describeArc(cx, cy, r, angleDeg) {
    if (angleDeg <= 0) {
      return '';
    }
    if (angleDeg >= 360) {
      // full circle
      return `
        M ${cx} ${cy - r}
        A ${r} ${r} 0 1 1 ${cx - 0.01} ${cy - r}
        Z
      `;
    }
    const largeArcFlag = (angleDeg > 180) ? 1 : 0;
    const sweepFlag    = 1;
    const angleRad     = (Math.PI / 180) * angleDeg;

    const startX = cx;
    const startY = cy - r;
    const endX   = cx + r * Math.sin(angleRad);
    const endY   = cy - r * Math.cos(angleRad);

    return `
      M ${cx} ${cy}
      L ${startX} ${startY}
      A ${r} ${r} 0 ${largeArcFlag} ${sweepFlag} ${endX} ${endY}
      Z
    `;
  }

  // Refresh button => reload page (reset everything)
  refreshButton.addEventListener('click', () => {
    location.reload();
  });

  // Dark mode toggle => toggles "dark-mode" class on body & saves preference
  darkModeToggle.addEventListener('change', (e) => {
    const isDark = e.target.checked;
    document.body.classList.toggle('dark-mode', isDark);
    localStorage.setItem(STORAGE_THEME_KEY, isDark);
  });

  // Tap the circle => Start/Pause/Resume
  circleArea.addEventListener('click', onCircleTap);

  // On load
  init();
</script>
</body>
</html>
